<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dettaglio Auto - Autosport</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .detail-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f3f4f6;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            font-weight: 600;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .back-btn:hover {
            background: #e5e7eb;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .gallery-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .main-image {
            width: 100%;
            height: 500px;
            background-size: cover;
            background-position: center;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        
        .thumbnail {
            width: 100%;
            height: 80px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .thumbnail:hover,
        .thumbnail.active {
            border-color: #2563eb;
        }
        
        .info-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .car-title-detail {
            font-size: 2em;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .car-price-detail {
            font-size: 2.5em;
            color: #2563eb;
            font-weight: bold;
            margin-bottom: 30px;
        }
        
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .spec-item {
            padding: 15px;
            background: #f3f4f6;
            border-radius: 8px;
        }
        
        .spec-label {
            font-size: 0.85em;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .spec-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #1f2937;
        }
        
        .description-box {
            background: #eff6ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2563eb;
            margin-bottom: 30px;
        }
        
        .cta-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (max-width: 992px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .main-image {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="top-bar">
            <div class="container">
                <div class="contact-info">
                    <a href="mailto:autosportvetture@gmail.com" class="contact-item">
                        <span>‚úâÔ∏è</span> autosportvetture@gmail.com
                    </a>
                    <a href="tel:+390399686292" class="contact-item">
                        <span>üìû</span> 039 968 6292
                    </a>
                    <a href="tel:+393400024151" class="contact-item">
                        <span>üì±</span> 340 002 4151
                    </a>
                </div>
            </div>
        </div>
        
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <img src="logo.png" alt="Autosport" style="height: 60px;">
                </div>
            </div>
        </nav>
    </header>

    <div class="detail-container">
        <a href="index.html" class="back-btn">‚Üê Torna alle Auto</a>
        
        <div class="detail-grid">
            <!-- Gallery Section -->
            <div class="gallery-section">
                <div id="mainImage" class="main-image"></div>
                <div id="thumbnails" class="thumbnails"></div>
            </div>
            
            <!-- Info Section -->
            <div class="info-section">
                <h1 class="car-title-detail" id="carTitle"></h1>
                <div class="car-price-detail" id="carPrice"></div>
                
                <div class="specs-grid" id="specsGrid"></div>
                
                <div class="description-box" id="descriptionBox" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: #2563eb;">üìù Descrizione</h4>
                    <p id="carDescription"></p>
                </div>
                
                <div class="cta-buttons">
                    <button class="btn btn-primary btn-large" onclick="contactAboutThisCar()">
                        üí¨ Contattaci per questa Auto
                    </button>
                    <a href="tel:+390399686292" class="btn btn-secondary btn-large">
                        üìû Chiama Ora
                    </a>
                    <a href="https://wa.me/393400024151" target="_blank" class="btn btn-secondary btn-large">
                        üì± WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" style="margin-top: 60px;">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Autosport Robbiate - Tutti i diritti riservati</p>
            </div>
        </div>
    </footer>

    <script>
        // Get car ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const carId = parseInt(urlParams.get('id'));
        
        let db;
        
        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('AutosportDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('cars')) {
                        db.createObjectStore('cars', { keyPath: 'id' });
                    }
                };
            });
        }
        
        // Load car details
        async function loadCarDetails() {
            await initDB();
            
            const transaction = db.transaction(['cars'], 'readonly');
            const objectStore = transaction.objectStore('cars');
            const request = objectStore.getAll();
            
            request.onsuccess = () => {
                const cars = request.result || [];
                const car = cars.find(c => c.id === carId);
                
                if (!car) {
                    document.querySelector('.detail-container').innerHTML = `
                        <div style="text-align: center; padding: 100px 20px;">
                            <h2>Auto non trovata</h2>
                            <a href="index.html" class="btn btn-primary" style="margin-top: 20px;">Torna alle Auto</a>
                        </div>
                    `;
                    return;
                }
                
                // Update title and price
                document.getElementById('carTitle').textContent = `${car.marca.toUpperCase()} ${car.modello}`;
                document.getElementById('carPrice').textContent = `‚Ç¨${car.prezzo.toLocaleString()}`;
                document.title = `${car.marca.toUpperCase()} ${car.modello} - Autosport`;
                
                // Show description if present
                if (car.descrizione) {
                    document.getElementById('descriptionBox').style.display = 'block';
                    document.getElementById('carDescription').textContent = car.descrizione;
                }
                
                // Load images
                if (car.images && car.images.length > 0) {
                    const mainImage = document.getElementById('mainImage');
                    const thumbnails = document.getElementById('thumbnails');
                    
                    mainImage.style.backgroundImage = `url('${car.images[0]}')`;
                    
                    car.images.forEach((img, index) => {
                        const thumb = document.createElement('div');
                        thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
                        thumb.style.backgroundImage = `url('${img}')`;
                        thumb.onclick = () => {
                            mainImage.style.backgroundImage = `url('${img}')`;
                            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                            thumb.classList.add('active');
                        };
                        thumbnails.appendChild(thumb);
                    });
                }
                
                // Load specs
                const specs = [
                    { label: 'Anno', value: car.anno },
                    { label: 'Chilometri', value: car.km.toLocaleString() + ' km' },
                    { label: 'Carburante', value: capitalizeFirst(car.carburante) },
                    { label: 'Cambio', value: car.cambio },
                    { label: 'Potenza', value: car.cv + ' CV' },
                    { label: 'Posti', value: car.posti },
                    { label: 'Tipo', value: capitalizeFirst(car.tipo) },
                    { label: 'Garanzia', value: car.garantita ? 'S√¨' : 'No' }
                ];
                
                const specsGrid = document.getElementById('specsGrid');
                specs.forEach(spec => {
                    const specItem = document.createElement('div');
                    specItem.className = 'spec-item';
                    specItem.innerHTML = `
                        <div class="spec-label">${spec.label}</div>
                        <div class="spec-value">${spec.value}</div>
                    `;
                    specsGrid.appendChild(specItem);
                });
            };
        }
        
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        async function contactAboutThisCar() {
            await initDB();
            
            const transaction = db.transaction(['cars'], 'readonly');
            const objectStore = transaction.objectStore('cars');
            const request = objectStore.getAll();
            
            request.onsuccess = () => {
                const cars = request.result || [];
                const car = cars.find(c => c.id === carId);
                
                if (car) {
                    const message = `Ciao! Sono interessato/a a: ${car.marca.toUpperCase()} ${car.modello} - ‚Ç¨${car.prezzo.toLocaleString()}`;
                    window.open(`https://wa.me/393400024151?text=${encodeURIComponent(message)}`, '_blank');
                }
            };
        }
        
        // Load on page load
        loadCarDetails();
    </script>
</body>
</html>